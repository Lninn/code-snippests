{% extends '__base__.html' %}

{% block title %}登陆{% endblock %}

{% block beforehead %}
<script>
    window.onload = function () {

        const vm = new Vue({
            el: '#id-login',
            data (){
                return {
                    email: '',
                    password: ''
                }
            },
            methods: {
                submit: function(event) {
                    event.preventDefault()

                    if (!validateEmail(this.email.trim().toLowerCase())) {
                        return alert('请输入正确的Email地址')
                    }
                    if (!this.password.trim()) {
                        return alert('请输入密码')
                    }

                    const email = this.email.trim().toLowerCase()
                    const password = this.password.trim()
                    // log('登陆请求的参数：', email, password)
                    axios.post('/api/authenticate', {
                        email: email,
                        password: CryptoJS.SHA1(email + ':' + password).toString()
                    })
                    .then(function (data) {
                        log(data)
                        data = data.data

                        if (data.error) {
                            return alert('error status: ' + data.error + 'message: ' + data.message)
                        } else {
                            return location.assign('/')
                        }

                    })
                    .catch(function (error) {
                        log('error', error)
                    })
                }
            }
        });
    }
</script>
{% endblock %}

{% block content %}
<div class="uk-width-medium-1-1 uk-width-large-1-1 uk-width-small-1-1">
    <h1 class="uk-h2 uk-text-center">登陆你的账户</h1>
    <div class="uk-container-center uk-width-medium-2-5 uk-width-large-3-10 uk-width-small-3-5 uk-margin-large-top">
        <form id="id-login" method="post" class="uk-form uk-form-stacked">
            <div class="uk-form-row">
                <label class="uk-form-label">邮箱</label>
                <div class="uk-form-controls">
                    <input type="text" v-model="email" key="email" name="email" value="" class="uk-form-large uk-width-1-1" maxlength="40">
                </div>
            </div>
            <div class="uk-form-row">
                <label class="uk-form-label">密码</label>
                <div class="uk-form-controls">
                    <input type="password" v-model="password" key="password" name="password" value="" class="uk-form-large uk-width-1-1" maxlength="40">
                </div>
            </div>
            <button type="submit" name="_login" class="uk-button uk-button-primary uk-width-1-1 uk-button-large uk-margin-top loader" id="id-login-btn" @click="submit">登陆</button>
            <div class="uk-grid uk-text-small uk-margin-small-top">
                <div class="uk-form-controls uk-form-controls-text uk-width-1-2">
                    <input type="checkbox" name="remember_me" value="yes">记住密码？</div>
                <div class="uk-width-1-2 uk-text-right">
                    <a href="#">忘记密码？</a>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1-1 uk-margin-top uk-text-right">
                    还没有创建账户? <a href="/register">注册</a>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}
