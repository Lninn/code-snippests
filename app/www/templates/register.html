{% extends '__base__.html' %}

{% block title %}注册{% endblock %}

{% block beforehead %}
<script>
window.onload = function() {
    var vm = new Vue({
        el: '#vm',
        data () {
            return {
                username: '',
                email: '',
                password1: '',
                password2: ''
            }
        },
        methods: {
            submit: function (event) {
                event.preventDefault();

                if (! this.username.trim()) {
                    return alert('请输入姓名')
                }
                if (! validateEmail(this.email.trim().toLowerCase())) {
                    return alert('请输入正确的Email地址')
                }
                if (this.password1.length < 6) {
                    return alert('口令长度至少为6个字符')
                }
                if (this.password1 !== this.password2) {
                    return alert('两次输入的密码不一致')
                }
                var email = this.email.trim().toLowerCase()

                axios.post('/api/users', {
                    name: this.username.trim(),
                    email: email,
                    password: CryptoJS.SHA1(email + ':' + this.password1).toString()
                  })
                  .then(function (data) {
                    data = data.data

                    if (data.error) {
                        return alert('error status: ' + data.error + 'message: ' + data.message)
                    } else {
                        return location.assign('/')
                    }
                  })
                  .catch(function (error) {
                    log('error', error)
                  })
            }
        }
    });
}
</script>
{% endblock %}

{% block content %}
<div class="uk-width-medium-1-1 uk-width-large-1-1 uk-width-small-1-1">
    <h1 class="uk-h2 uk-text-center">创建一个账户</h1>
    <div class="uk-container-center uk-width-medium-2-5 uk-width-large-3-10 uk-width-small-3-5 uk-margin-large-top">
        <form id="vm" v-on:submit="submit" method="post" ref="register-form" class="uk-form uk-form-stacked">
            <div class="uk-form-row">
                <label class="uk-form-label">用户名</label>
                <div class="uk-form-controls">
                    <input v-model="username" type="text" name="username" value="" class="uk-form-large uk-width-1-1" maxlength="40">
                </div>
            </div>
            <div class="uk-form-row">
                <label class="uk-form-label">邮箱地址</label>
                <input type="email" v-model="email" name="email" value="" class="uk-form-large uk-width-1-1" maxlength="40">
            </div>
            <div class="uk-form-row">
                <label class="uk-form-label">密码</label>
                <input type="password" v-model="password1" name="password1" value="" class="uk-form-large uk-width-1-1" maxlength="40">
            </div>
            <div class="uk-form-row">
                <label class="uk-form-label">重复密码</label>
                <input type="password" v-model="password2" name="password2" value="" class="uk-form-large uk-width-1-1" maxlength="40">
            </div>
            <div class="uk-grid uk-form-row">
                <div class="g-recaptcha uk-width-1-1" data-sitekey="6Lcoqf4SAAAAAKdzuQxA_tUdeSGPfQ5vjTMCX4aa"></div>
            </div>
            <button id="signup-button" type="submit" name="_signup" class="uk-button uk-button-primary uk-width-1-1 uk-button-large uk-margin-large-top loader">注册</button>
        </form>
    </div>
    <p class="uk-text-x-small uk-text-center">创建这个账户意味着你同意 <a href="/terms">《xxx服务》</a> and <a href="/privacy">《xxx政策和协议》</a></p>
</div>
{% endblock %}
